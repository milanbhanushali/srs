@{
    ViewData["Title"] = "Customer Dashboard";
    Layout = "~/Views/Shared/_LayoutCustomer.cshtml";
}
@using Microsoft.AspNetCore.Http;
@model IEnumerable<Helperland.Models.ViewModel.CustomerServiceHistoryViewModel>
<!--#region Upcoming Service Welcome part & Dashboard-->
<span class="d-none" id="customerEmail" value="@Context.Session.GetString("userEmail")"></span>
<div class="col-lg-8 col-md-12 col-sm-12">
    <div class="custom-upcoming-service-right-side table-responsive">
        <table class="table border" id="tblCustomerModalServiceHistory">
            <thead class="table-light borderless">
                <tr>
                    <th>&nbsp;&nbsp;&nbsp;Service ID <img src="~/img/up-down-arrows.webp" alt=""></th>
                    <th>
                        <span>
                            Service date <img src="~/img/up-down-arrows.webp" alt=""
                                              class="updown-arrows-dashboard">
                        </span>
                    </th>
                    <th>
                        Service Provider <img src="~/img/up-down-arrows.webp" alt=""
                                              class="updown-arrows-dashboard">
                    </th>
                    <th>
                        &nbsp;&nbsp;Payment <img src="~/img/up-down-arrows.webp" alt=""
                                                 class="updown-arrows-dashboard">
                    </th>
                    <th>&nbsp;&nbsp;&nbsp;Action</th>
                </tr>
            </thead>
            <tbody id="tbodyCustomerModalServiceHistory">

                @foreach (var item in Model)
                {
                    <tr>
                        <td onclick="OpenModal(@item.ServiceId)" data-bs-toggle="modal" data-bs-target="#ModalServiceHistory" class="custom-pointer pt-3 ps-4">@item.ServiceId</td>
                        <td onclick="OpenModal(@item.ServiceId)" class="custom-pointer">
                            <img src="~/img/calendar2.png" alt=""> @item.ServiceStartDate <br> <img src="~/img/clock.png"
                                                                                                    alt=""> 12:00 - 18:00
                        </td>
                        <td class="custom-break-text">
                            @if (item.ServiceProviderName != null)
                            {
                                <div class="row mt-1 justify-content-start">
                                    <div class="col-4 custom-border-cap">
                                        <img src="./assets/img/gray-cap.webp" alt="" class="">
                                    </div>
                                    <div class="col-8 text-start">
                                        @item.ServiceProviderName
                                        <div class="">
                                            <img src="assets/img/yellow-star.webp" alt="">
                                            <img src="assets/img/yellow-star.webp" alt="">
                                            <img src="assets/img/yellow-star.webp" alt="">
                                            <img src="assets/img/yellow-star.webp" alt="">
                                            <img src="assets/img/black-star.webp" alt="">
                                            <span class="dashboard-number-text">4</span>
                                        </div>
                                    </div>
                                </div>
                            }

                        </td>
                        <td class="text-center pt-3 pe-5"><b> @item.TotalCost £</b></td>
                        <td><button id="btnReschedule" class="btn btn-info rounded-pill text-white me-1">Reschedule</button><button id="btnCancelService" class="custom-cancel-btn">Cancel</button></td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<!-- Button trigger modal -->
@*<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalServiceHistory">
        Launch static backdrop modal
    </button>*@

<!-- Modal -->
<div class="modal fade" id="ModalServiceHistory" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="ModalServiceHistoryLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title custom-text-dim-gray" id="staticBackdropLabel">Service Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-start">
                <h4 id="ModalServiceDateTime"></h4> <br />
                Duration : <span id="ModalServiceTotalHours"></span>
                <hr />
                Service Id: <span id="ModalServiceID"></span><br />
                Extras: <span id="ModalExtraService"></span><br />
                Net Amount: <span class="custom-text-color-green" id="ModalNetAmount"></span><br />
                <hr />
                Address: <span id="ModalServiceAddress"></span><br />
                Billing Address: <span id="ModalServiceBillingAddress"></span><br />
                Phone: <span class="custom-text-color-green" id="ModalServiceMobile"></span><br />
                Email: <span class="custom-text-color-green" id="ModalServiceEmail"></span><br />
                <hr />
                Comments: <span id="ModalServiceComments"></span> <br />
                <span id="ModalServicePets"></span>
            </div>



            <div class="modal-footer justify-content-start">
                <button type="button" id="btnModalReschedule" class="btn btn-primary">Reschedule</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>

<!--#endregion Upcoming Service Welcome part & Dashboard-->

<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>

<script>

    function OpenModal(id) {
        console.log("Button Click" + id);
        
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetUserServiceHistoryData")",
            data: { "ServiceRequestId": id },
            success: function (response) {
                console.log(response);
                var objResponse = JSON.parse(JSON.stringify(response));
                $("#ModalServiceDateTime").text(objResponse.serviceStartDate);
                $("#ModalServiceTotalHours").text(objResponse.totalHours);
                $("#ModalServiceID").text(id);
                $("#ModalNetAmount").text(objResponse.totalCost);
                $("#ModalServiceAddress").text(objResponse.addressLine1 + " " + objResponse.addressLine2);
                $("#ModalServiceMobile").text(objResponse.mobile);
                $("#ModalServiceEmail").val($("#customerEmail").val());
                $("#ModalServiceComments").text(objResponse.comments);
                $("#ModalServicePets").text(objResponse.hasPets);
            }
        });
        $("#ModalServiceHistory").modal('show');
    }

    $(document).ready(function () {
        $.noConflict();
        $('#tblCustomerModalServiceHistory').dataTable({
            "bFilter": false,
            "bInfo": false,
            'aoColumnDefs': [{ 'bSortable': false, 'aTargets': [-1] }]
        });
        /*            alert($("#userID").val());*/

    });
</script>